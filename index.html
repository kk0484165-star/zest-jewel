<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zest Jewel</title>

<style>
body{margin:0;font-family:Arial;background:#fff8f0}
header{background:#d4af37;color:#fff;padding:15px;text-align:center;font-size:22px;font-weight:bold}
.wrap{padding:15px;max-width:1100px;margin:auto}
.card{background:#fff;padding:15px;border-radius:14px;box-shadow:0 5px 15px rgba(0,0,0,.1);margin-bottom:20px}
.grid{display:flex;flex-wrap:wrap;gap:15px}
.p{width:250px}
.p img{width:100%;height:180px;object-fit:cover;border-radius:12px;background:#eee}
button{padding:8px 12px;background:green;color:#fff;border:none;border-radius:8px;cursor:pointer}
button.danger{background:red}
input,textarea{padding:8px;margin:6px 0;width:100%;border-radius:8px;border:1px solid #ccc}
.hide{display:none}

/* Welcome */
#welcome{
position:fixed;
top:0;left:0;
width:100%;height:100vh;
background:#fff8f0;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
z-index:9999;
}
#welcome img{width:260px;margin-bottom:20px}
</style>
</head>

<body>

<!-- Welcome Screen -->
<div id="welcome">
<img src="LOGO.jpeg">
<button onclick="enterStore()">Enter Store</button>
</div>

<header>Zest Jewel Store</header>

<div class="wrap">

<!-- Products Page -->
<div id="productsPage">
<div class="card">
<h2>Products</h2>
<div id="productsDiv" class="grid"></div>
</div>
</div>

<!-- Details Page -->
<div id="detailsPage" class="hide">
<div class="card">
<button onclick="backToProducts()">⬅ Back</button>
<h2 id="dName"></h2>
<img id="dImg" style="width:100%;max-width:400px;height:250px;object-fit:cover;border-radius:12px;background:#eee">
<p><b>Price:</b> ₹<span id="dPrice"></span></p>
<p id="dDesc"></p>

<h3>Order Details</h3>
<input id="custName" placeholder="Your Name">
<input id="custPhone" placeholder="Mobile Number">
<textarea id="custAddress" placeholder="Address"></textarea>
<button onclick="sendOrder()">Order on WhatsApp</button>
</div>
</div>

<!-- Admin Login (always visible at bottom) -->
<div class="card">
<h3>Admin Login</h3>
<input id="aemail" placeholder="Email">
<input id="apass" type="password" placeholder="Password">
<button onclick="adminLogin()">Login</button>
<button onclick="adminLogout()">Logout</button>

<div id="adminTools" class="hide">
<hr>
<h4>Add Product</h4>
<input id="pname" placeholder="Product Name">
<input id="pprice" type="number" placeholder="Price">
<input id="pimg" placeholder="Image URL">
<input id="pdesc" placeholder="Description">
<button onclick="addProduct()">Add Product</button>
</div>

</div>

</div>

<script type="module">

const WHATSAPP_NUMBER="919888727117";

const firebaseConfig={
apiKey:"AIzaSyDXRGjrOmlWGB5I3fZCBpFj-Rv_RLkHg2s",
authDomain:"zest-jewel.firebaseapp.com",
projectId:"zest-jewel",
storageBucket:"zest-jewel.firebasestorage.app",
messagingSenderId:"350610946972",
appId:"1:350610946972:web:8f550c0584350455712659"
};

import {initializeApp} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {getAuth,signInWithEmailAndPassword,signOut,onAuthStateChanged} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import {getFirestore,collection,addDoc,onSnapshot,query,orderBy,serverTimestamp,deleteDoc,doc} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const productsRef=collection(db,"products");
const q=query(productsRef,orderBy("createdAt","desc"));

const productsDiv=document.getElementById("productsDiv");

let selectedProduct=null;
let isAdmin=false;

/* OLD + NEW IMAGE SUPPORT */
function getImage(p){
return p.imgUrl || p.img || p.image || p.photo || p.pimg || p.url || "";
}

onSnapshot(q,(snap)=>{
productsDiv.innerHTML="";
snap.forEach((d)=>{
const p=d.data();
const img=getImage(p);

const el=document.createElement("div");
el.className="card p";

el.innerHTML=`
<img src="${img}" onerror="this.src='LOGO.jpeg'">
<div><b>${p.name||"Product"}</b></div>
<div>₹${p.price||0}</div>
<button onclick="openDetails('${p.name}','${p.price}','${img}','${p.desc||""}')">Buy</button>
${isAdmin?`<button class="danger" onclick="delProduct('${d.id}')">Delete</button>`:""}
`;

productsDiv.appendChild(el);
});
});

/* DETAILS */
window.openDetails=(name,price,img,desc)=>{
selectedProduct={name,price,img,desc};
document.getElementById("productsPage").classList.add("hide");
document.getElementById("detailsPage").classList.remove("hide");
document.getElementById("dName").innerText=name;
document.getElementById("dPrice").innerText=price;
document.getElementById("dImg").src=img;
document.getElementById("dDesc").innerText=desc;
};

window.backToProducts=()=>{
document.getElementById("detailsPage").classList.add("hide");
document.getElementById("productsPage").classList.remove("hide");
};

/* WHATSAPP */
window.sendOrder=()=>{
const nm=document.getElementById("custName").value;
const ph=document.getElementById("custPhone").value;
const ad=document.getElementById("custAddress").value;

if(!nm||!ph){alert("Fill Name & Phone");return;}

const msg=
"Hello Zest Jewel!%0A%0A"+
"Customer: "+encodeURIComponent(nm)+"%0A"+
"Phone: "+encodeURIComponent(ph)+"%0A"+
"Address: "+encodeURIComponent(ad)+"%0A%0A"+
"Product: "+encodeURIComponent(selectedProduct.name)+"%0A"+
"Price: ₹"+encodeURIComponent(selectedProduct.price);

window.open("https://wa.me/"+WHATSAPP_NUMBER+"?text="+msg,"_blank");
};

/* ADMIN */
window.adminLogin=async()=>{
const email=document.getElementById("aemail").value;
const pass=document.getElementById("apass").value;
await signInWithEmailAndPassword(auth,email,pass);
};

window.adminLogout=async()=>{await signOut(auth);};

onAuthStateChanged(auth,(user)=>{
isAdmin=!!user;
document.getElementById("adminTools").classList.toggle("hide",!isAdmin);
});

window.addProduct=async()=>{
if(!isAdmin)return alert("Login first");
await addDoc(productsRef,{
name:document.getElementById("pname").value,
price:document.getElementById("pprice").value,
imgUrl:document.getElementById("pimg").value,
desc:document.getElementById("pdesc").value,
createdAt:serverTimestamp()
});
};

window.delProduct=async(id)=>{
if(!isAdmin)return;
await deleteDoc(doc(db,"products",id));
};

</script>

<script>
function enterStore(){
document.getElementById("welcome").style.display="none";
}
</script>

</body>
</html>
